<html>

<head>
    <title>INFO 3300 - project1</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        .gridlines line {
            stroke: #bbb;
        }

        .gridlines .domain {
            stroke: none;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            font-weight: 300;
        }

        .axis-label {
            font-size: 8px;
            font-weight: 300;
        }

        .legend {
            font-size: 12px;
            font-weight: 300;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 20px;
        }


        .scatter-container {
            width: 500px;
            height: 500px;
        }

        .temp-container {
            width: 500px;
            height: 250px;
        }
    </style>
</head>

<body>
    <div class="chart-grid">
        <svg id="sanfroncisco_humidity" width="500" height="250"> </svg>
        <svg id="sanfroncisco_humidity" width="500" height="250"> </svg>
        <svg id="sanfroncisco_humidity" width="500" height="250"> </svg>

        <div id="sanfrancisco_scatter" class="scatter-container"></div>
        <div id="nyc_scatter" class="scatter-container"></div>
        <div id="miami_scatter" class="scatter-container"></div>

        <div id="sanfrancisco_temp" class="temp-container"></div>
        <div id="nyc_temp" class="temp-container"></div>
        <div id="miami_temp" class="temp-container"></div>
    </div>

    <script id="humidity">
        (function () {
            const svg1 = d3.selectAll("svg#sanfroncisco_humidity");

            //margin, width, height
            const margins = { top: 20, right: 20, bottom: 20, left: 40 };
            const width = svg1.attr("width");
            const height = svg1.attr("height");
            const chartWidth = width - margins.left - margins.right;
            const chartHeight = height - margins.top - margins.bottom;


            function daysInYear(a) {
                let month = a.getMonth();
                let day = 0;
                if (month === 1) {
                    day = a.getD
                }
            }


            d3.csv('sanfrancisco.csv').then((data) => {
                const parsedDate = d3.timeParse("%Y-%m-%d");
                //const dayOfYear = Math.floor((data-new Date(data.getFullYear(), 0, 0)));
                //console.log(dayOfYear);
                //console.log(parsedDate);
                //console.log(data);


                const HumidityExtent = d3.extent(data, d => Number(d['Mean.Humidity']));
                const HumidityScale = d3.scaleSequential()
                    .domain(HumidityExtent)
                    .range([0, 1])
                    .interpolator(d3.interpolateBlues);

                const dayScale = d3.scaleLinear()
                    .domain([0, 366])
                    .range([0, chartWidth]);

                const Xmonth = d3.extent(data, d => Number(d['Date'].substring(5, 7)));
                const XmonthScale = d3.scaleLinear()
                    .domain(Xmonth)
                    .range([0, chartWidth]);

                const Yyear = d3.extent(data, d => Number(d['Date'].substring(0, 4)));
                const YyearScale = d3.scaleLinear()
                    .domain(Yyear)
                    .range([chartHeight, 0]);



                console.log(XmonthScale.domain());
                console.log(HumidityExtent);



                //Axes
                let bottomMonthAxis = d3.axisBottom(XmonthScale);
                console.log(bottomMonthAxis);
                svg1.append("g")
                    .attr("transform", `translate(${margins.left},${margins.top + chartHeight})`)
                    .call(bottomMonthAxis);

                let bottomGridlines = d3.axisBottom(XmonthScale).tickFormat("").tickSize(-chartHeight - 10);
                svg1.append("g")
                    .attr("class", "gridlines")
                    .attr("transform", `translate(${margins.left},${margins.top + chartHeight + 10})`)
                    .call(bottomGridlines);

                let YyearAxis = d3.axisLeft(YyearScale);
                svg1.append("g")
                    .attr("transform", `translate(${margins.left},${margins.top})`)
                    .call(YyearAxis);
                let YyearAxisGridLines = d3.axisLeft(YyearScale).tickFormat('').tickSize(-chartWidth - 10);
                svg1.append("g")
                    .attr("class", "gridlines")
                    .attr("transform", `translate(${margins.left - 10},${margins.top})`)
                    .call(YyearAxisGridLines);

                let charArea = svg1.append('g')
                    .attr('transform', `translate(${margins.left},${margins.top})`);

                //Circles!
                let dayRN = 0;
                let yrOfPrev = data[0]['Date'].substring(0, 4);
                console.log(yrOfPrev);
                data.forEach((d) => {
                    const date = parsedDate(d['Date']); // Parse the date string
                    const currYr = date.getFullYear(); // Get the year
                    const currDayOfYear = d3.timeDay.count(d3.timeYear(date), date);
                    // dayRN = currDayOfYear;
                    //console.log(dayRN);

                    //let currYr=Number(d.Date.substring(0,4));

                    // if(yrOfPrev===currYr){
                    //     dayRN+=1;
                    //     prevYr=currYr;
                    //     //console.log(yrOfPrev+"   "+currYr);
                    // }
                    // if(yrOfPrev!=currYr){
                    //     dayRN=1;
                    //     prevYr=currYr;
                    //     //console.log(yrOfPrev+" newyear  "+currYr);
                    // }
                    // dayRN+=1;
                    // prevYr+=1;
                    // //console.log(dayRN);

                    //let currDay=Number(parseDate(d['Date']));
                    let currHumidity = d['Mean.Humidity'];

                    charArea.append('circle')
                        .attr('r', 3)
                        .attr('cx', d => dayScale(currDayOfYear))
                        .attr('cy', d => YyearScale(currYr))
                        .style("fill", HumidityScale(currHumidity))

                });
            })
        })();

    </script>

    <script id="scatter">
        (function () {
            const margin = { top: 30, right: 120, bottom: 60, left: 60 },
                width = 500 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            const comfortableTemperature = 72;
            const comfortableHumidity = 60;

            const cities = [
                { name: 'San Francisco', file: 'sanfrancisco.csv', container: '#sanfrancisco_scatter' },
                { name: 'New York City', file: 'nyc.csv', container: '#nyc_scatter' },
                { name: 'Miami', file: 'miami.csv', container: '#miami_scatter' }
            ];

            const seasonYearColorScale = d3.scaleOrdinal()
                .domain([
                    'Winter-1980', 'Winter-1990', 'Winter-2000', 'Winter-2010',
                    'Spring-1980', 'Spring-1990', 'Spring-2000', 'Spring-2010',
                    'Summer-1980', 'Summer-1990', 'Summer-2000', 'Summer-2010',
                    'Fall-1980', 'Fall-1990', 'Fall-2000', 'Fall-2010'
                ])
                .range([
                    '#c6dbef', '#9ecae1', '#6baed6', '#1f77b4', // Winter shades
                    '#ccece6', '#99d8c9', '#66c2a4', '#2ca02c', // Spring shades
                    '#ff9999', '#ff4d4d', '#ff1a1a', '#b30000', // Summer shades
                    '#ffcc66', '#ff9933', '#ff6600', '#cc5200'  // Fall shades
                ]);

            function visualizeCityData(city) {
                d3.csv(city.file, d3.autoType).then(data => {

                    data = data.filter(d => {
                        const year = new Date(d.Date).getFullYear();
                        return [1980, 1990, 2000, 2010].includes(year);
                    });

                    const x = d3.scaleLinear().domain([0, 100]).range([0, width]);
                    const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);

                    const svg = d3.select(city.container).append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);

                    svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).ticks(5));
                    svg.append("g").call(d3.axisLeft(y).ticks(5));
                    svg.selectAll("path.domain").remove();

                    svg.append('g')
                        .selectAll("circle")
                        .data(data)
                        .join("circle")
                        .attr("cx", d => x(d['Mean.TemperatureF']))
                        .attr("cy", d => y(d['Mean.Humidity']))
                        .attr("r", 2)
                        .style("fill", d => {
                            const date = new Date(d.Date);
                            const month = date.getMonth() + 1;
                            const year = date.getFullYear();
                            const season = month >= 3 && month <= 5 ? 'Spring' : month >= 6 && month <= 8 ? 'Summer' : month >= 9 && month <= 11 ? 'Fall' : 'Winter';
                            return seasonYearColorScale(`${season}-${year}`);
                        })
                        .style("opacity", 0.5);


                    svg.append("line")
                        .attr("x1", x(comfortableTemperature))
                        .attr("x2", x(comfortableTemperature))
                        .attr("y1", 0)
                        .attr("y2", height)
                        .attr("stroke", "grey")
                        .attr("stroke-width", 1)
                        .attr("stroke-dasharray", "4");

                    svg.append("line")
                        .attr("x1", 0)
                        .attr("x2", width)
                        .attr("y1", y(comfortableHumidity))
                        .attr("y2", y(comfortableHumidity))
                        .attr("stroke", "grey")
                        .attr("stroke-width", 1)
                        .attr("stroke-dasharray", "4");

                    svg.append("text")
                        .attr("x", width / 2)
                        .attr("y", -10)
                        .attr("text-anchor", "middle")
                        .style("font-size", "16px")
                        .style("font-weight", "300")
                        .text(`${city.name} (1980-2010)`);

                    svg.append("text")
                        .attr("text-anchor", "end")
                        .attr("x", width / 2 + 60)
                        .attr("y", height + margin.top)
                        .attr("class", "axis-label")
                        .text("Mean Temperature (F)");

                    svg.append("text")
                        .attr("text-anchor", "end")
                        .attr("transform", "rotate(-90)")
                        .attr("x", -height / 2 + 20)
                        .attr("y", -margin.left + 30)
                        .attr("class", "axis-label")
                        .text("Humidity(%)");

                    const legendData = seasonYearColorScale.domain().map(key => ({
                        key,
                        color: seasonYearColorScale(key)
                    }));

                    const legend = svg.selectAll(".legend")
                        .data(legendData)
                        .enter().append("g")
                        .attr("class", "legend")
                        .attr("transform", (d, i) => `translate(0,${i * 20})`);

                    legend.append("rect")
                        .attr("x", width + 15)
                        .attr("width", 18)
                        .attr("height", 18)
                        .style("fill", d => d.color);

                    legend.append("text")
                        .attr("x", width + 40)
                        .attr("y", 9)
                        .attr("dy", ".35em")
                        .style("text-anchor", "start")
                        .text(d => d.key);
                });
            }

            cities.forEach(city => visualizeCityData(city));
        })();
    </script>

    <script id="temp">
        (function () {
        })();

    </script>

</body>

</html>