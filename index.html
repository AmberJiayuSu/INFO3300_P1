<html>

<head>
    <title>INFO 3300 - project1</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        .gridlines line {
            stroke: #bbb;
        }

        .gridlines .domain {
            stroke: none;
        }

        h2{
            display: block;
        }

        body {
            width: 90%;
            font-family: 'Open Sans', sans-serif;
            font-weight: 300;
            margin-left: auto;
            margin-right: auto;
        }

        .axis-label {
            font-size: 10px;
            font-weight: 300;
        }

        .legend {
            font-size: 12px;
            font-weight: 300;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 20px;
        }

        .humidity-container {
            width: 500px;
            height: 300px;
        }

        .scatter-container {
            width: 500px;
            height: 500px;
        }

        .temp-container {
            width: 500px;
            height: 300px;
        }

        
    </style>
</head>

<body>
    
    <div class="chart-grid">

        
        
            <div class="temp-container"> 
                <svg id="sanfrancisco_temp" height="250" width="500" ></svg>
            </div>
            <div  class="temp-container">
                <svg id="nyc_temp" height="250" width="500" ></svg>
            </div>
            <div  class="temp-container">
                <svg id="miami_temp" height="250" width="500" ></svg>
            </div>
       
        
        

        <svg id="sanfrancisco_humidity" class="humidity-container"> </svg>
        <svg id="nyc_humidity" class="humidity-container"> </svg>
        <svg id="miami_humidity" class="humidity-container"> </svg>

        <div id="sanfrancisco_scatter" class="scatter-container"></div>
        <div id="nyc_scatter" class="scatter-container"></div>
        <div id="miami_scatter" class="scatter-container"></div>

        
    </div>

    <script id="globalConst">
        const miami = "./miami_post1980.csv";
        const sf = "./sf_post1980.csv";
        const nyc = "./nyc_post1980.csv";
    </script>

    <script id = "heatmap">
      
        let svg_temp_sf = d3.select("#sanfrancisco_temp");
        let svg_temp_nyc = d3.select("#nyc_temp"); 
        let svg_temp_miami = d3.select("#miami_temp");
        
        const cities = [
                { name: 'San Francisco', file: sf, svg: '#sanfrancisco_temp' },
                { name: 'New York City', file: nyc, svg: '#nyc_temp' },
                { name: 'Miami', file: miami, svg: '#miami_temp' }
        ];

        const margins = { top: 20, right: 20, bottom: 25, left: 45 };
        const width = 500;
        const height = 250;
        const chartWidth = width - margins.left - margins.right;
        const chartHeight = height - margins.top - margins.bottom;
        const tempExtent = [0,20,40,60,100]; 
        const yearExtent = [1980, 2015]; 

        const rectWidth = chartWidth / 365;
        const rectHeight = chartHeight / (yearExtent[1] - yearExtent[0] + 1) + 0.5;

        const rectHorOffset =rectWidth/2;
        const rectVerOffset = rectHeight/2;

        let yearScale = d3.scaleLinear()
            .domain(yearExtent)
            .range([0, chartHeight]);

        let dayScale = d3.scaleLinear()
            .domain([1,365])
            .range([0, chartWidth]);

        const monthOffset = chartWidth / 12;

        let monthScale = d3.scaleLinear()
            .domain([1, 12])
            .range([0, chartWidth - monthOffset]);

        

        let colorScale = d3.scaleSequential().domain([100,0]).interpolator(d3.interpolateRdYlBu);
        

        const heatmap = async function(city){
            const data = await d3.csv(city.file,d3.autoType);
            

            const heatmapsvg = d3.select(city.svg);
            let annotations = heatmapsvg.append("g").attr("id","annotations");

            let leftAxis = d3.axisLeft(yearScale).tickFormat(d3.format("d"));

            annotations.append("g")
                        .attr("class", "heatmap y axis")
                        .attr("transform",`translate(${margins.left-5},${margins.top -  rectHeight/2})`)
                        .call(leftAxis)
                        .select(".domain")  
                        .attr("display", "none");

            let bottomAxis = d3.axisBottom(monthScale);

            annotations.append("g")
                        .attr("class", "heatmap x axis")
                        .attr("transform",`translate(${margins.left + monthOffset/2},${margins.top + chartHeight + 5})`)
                        .call(bottomAxis)
                        .select(".domain")  
                        .attr("display", "none");

            let chartArea = heatmapsvg.append('g')
                            .attr("transform",`translate(${margins.left},${margins.top})`);
            
            chartArea.selectAll("rect").data(data)
                .join("rect")
                .attr("x", d =>dayScale(d.Day))
                .attr("y", d => yearScale(d.Year) - rectHeight)
                .attr("width", rectWidth)
                .attr("height", rectHeight)
                .attr("fill", d => colorScale(d['Mean.Humidity']));     
                
            console.log(data[0].Day);
        }

        heatmap(cities[0]);
        heatmap(cities[1]);
        heatmap(cities[2]);
        
    </script>


    <script id = "humidmap">
        (function () {
        let svg_humid_sf = d3.select("#sanfrancisco_humidity");
        let svg_humid_nyc = d3.select("#nyc_humidity"); 
        let svg_humid_miami = d3.select("#miami_humidity");
        
        const cities = [
                { name: 'San Francisco', file: sf, svg: '#sanfrancisco_humidity' },
                { name: 'New York City', file: nyc, svg: '#nyc_humidity' },
                { name: 'Miami', file: miami, svg: '#miami_humidity' }
        ];

        // const margins = { top: 20, right: 20, bottom: 25, left: 45 };
        // const width = 500;
        // const height = 250;
        // const chartWidth = width - margins.left - margins.right;
        // const chartHeight = height - margins.top - margins.bottom;
        // const tempExtent = [0,20,40,60,100]; 
        // const yearExtent = [1980, 2015]; 

        // const rectWidth = chartWidth / 365;
        // const rectHeight = chartHeight / (yearExtent[1] - yearExtent[0] + 1) + 0.5;

        // const rectHorOffset =rectWidth/2;
        // const rectVerOffset = rectHeight/2;

        // let yearScale = d3.scaleLinear()
        //     .domain(yearExtent)
        //     .range([0, chartHeight]);

        // let dayScale = d3.scaleLinear()
        //     .domain([1,365])
        //     .range([0, chartWidth]);

        // const monthOffset = chartWidth / 12;

        // let monthScale = d3.scaleLinear()
        //     .domain([1, 12])
        //     .range([0, chartWidth - monthOffset]);

        

        let colorScale_humid = d3.scaleSequential().domain([100,0]).interpolator(d3.interpolateBlues);
        

        const humidmap = async function(city){
            const data = await d3.csv(city.file,d3.autoType);
            

            const humidmapsvg = d3.select(city.svg);
            let annotations = humidmapsvg.append("g").attr("id","annotations");

            let leftAxis = d3.axisLeft(yearScale).tickFormat(d3.format("d"));

            annotations.append("g")
                        .attr("class", "humidmap y axis")
                        .attr("transform",`translate(${margins.left-5},${margins.top -  rectHeight/2})`)
                        .call(leftAxis)
                        .select(".domain")  
                        .attr("display", "none");

            let bottomAxis = d3.axisBottom(monthScale);

            annotations.append("g")
                        .attr("class", "humidmap x axis")
                        .attr("transform",`translate(${margins.left + monthOffset/2},${margins.top + chartHeight + 5})`)
                        .call(bottomAxis)
                        .select(".domain")  
                        .attr("display", "none");

            let chartArea = humidmapsvg.append('g')
                            .attr("transform",`translate(${margins.left},${margins.top})`);
            
            chartArea.selectAll("rect").data(data)
                .join("rect")
                .attr("x", d =>dayScale(d.Day))
                .attr("y", d => yearScale(d.Year) - rectHeight)
                .attr("width", rectWidth)
                .attr("height", rectHeight)
                .attr("fill", d => colorScale_humid(d['Mean.TemperatureF']));     
                
            console.log(data[0].Day);
        }

        humidmap(cities[0]);
        humidmap(cities[1]);
        humidmap(cities[2]);
    })();
        
    </script>

    <script id="scatter">
        (function () {
            const margin = { top: 30, right: 120, bottom: 60, left: 60 },
                width = 500 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            const comfortableTemperature = 72;
            const comfortableHumidity = 60;

            const cities = [
                { name: 'San Francisco', file: 'sanfrancisco.csv', container: '#sanfrancisco_scatter' },
                { name: 'New York City', file: 'nyc.csv', container: '#nyc_scatter' },
                { name: 'Miami', file: 'miami.csv', container: '#miami_scatter' }
            ];

            const seasonYearColorScale = d3.scaleOrdinal()
                .domain([
                    'Winter-1980', 'Winter-1990', 'Winter-2000', 'Winter-2010',
                    'Spring-1980', 'Spring-1990', 'Spring-2000', 'Spring-2010',
                    'Summer-1980', 'Summer-1990', 'Summer-2000', 'Summer-2010',
                    'Fall-1980', 'Fall-1990', 'Fall-2000', 'Fall-2010'
                ])
                .range([
                    '#c6dbef', '#9ecae1', '#6baed6', '#1f77b4', // Winter shades
                    '#ccece6', '#99d8c9', '#66c2a4', '#2ca02c', // Spring shades
                    '#ff9999', '#ff4d4d', '#ff1a1a', '#b30000', // Summer shades
                    '#ffcc66', '#ff9933', '#ff6600', '#cc5200'  // Fall shades
                ]);

            function visualizeCityData(city) {
                d3.csv(city.file, d3.autoType).then(data => {

                    data = data.filter(d => {
                        const year = new Date(d.Date).getFullYear();
                        return [1980, 1990, 2000, 2010].includes(year);
                    });

                    const x = d3.scaleLinear().domain([0, 100]).range([0, width]);
                    const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);

                    const svg = d3.select(city.container).append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);

                    svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).ticks(5));
                    svg.append("g").call(d3.axisLeft(y).ticks(5));
                    svg.selectAll("path.domain").remove();

                    svg.append('g')
                        .selectAll("circle")
                        .data(data)
                        .join("circle")
                        .attr("cx", d => x(d['Mean.TemperatureF']))
                        .attr("cy", d => y(d['Mean.Humidity']))
                        .attr("r", 2)
                        .style("fill", d => {
                            const date = new Date(d.Date);
                            const month = date.getMonth() + 1;
                            const year = date.getFullYear();
                            const season = month >= 3 && month <= 5 ? 'Spring' : month >= 6 && month <= 8 ? 'Summer' : month >= 9 && month <= 11 ? 'Fall' : 'Winter';
                            return seasonYearColorScale(`${season}-${year}`);
                        })
                        .style("opacity", 0.5);


                    svg.append("line")
                        .attr("x1", x(comfortableTemperature))
                        .attr("x2", x(comfortableTemperature))
                        .attr("y1", 0)
                        .attr("y2", height)
                        .attr("stroke", "grey")
                        .attr("stroke-width", 1)
                        .attr("stroke-dasharray", "4");

                    svg.append("line")
                        .attr("x1", 0)
                        .attr("x2", width)
                        .attr("y1", y(comfortableHumidity))
                        .attr("y2", y(comfortableHumidity))
                        .attr("stroke", "grey")
                        .attr("stroke-width", 1)
                        .attr("stroke-dasharray", "4");

                    svg.append("text")
                        .attr("x", width / 2)
                        .attr("y", -10)
                        .attr("text-anchor", "middle")
                        .style("font-size", "16px")
                        .style("font-weight", "300")
                        .text(`${city.name} (1980-2010)`);

                    svg.append("text")
                        .attr("text-anchor", "end")
                        .attr("x", width / 2 + 60)
                        .attr("y", height + margin.top)
                        .attr("class", "axis-label")
                        .text("Mean Temperature (F)");

                    svg.append("text")
                        .attr("text-anchor", "end")
                        .attr("transform", "rotate(-90)")
                        .attr("x", -height / 2 + 20)
                        .attr("y", -margin.left + 30)
                        .attr("class", "axis-label")
                        .text("Humidity(%)");

                    const legendData = seasonYearColorScale.domain().map(key => ({
                        key,
                        color: seasonYearColorScale(key)
                    }));

                    const legend = svg.selectAll(".legend")
                        .data(legendData)
                        .enter().append("g")
                        .attr("class", "legend")
                        .attr("transform", (d, i) => `translate(0,${i * 20})`);

                    legend.append("rect")
                        .attr("x", width + 15)
                        .attr("width", 18)
                        .attr("height", 18)
                        .style("fill", d => d.color);

                    legend.append("text")
                        .attr("x", width + 40)
                        .attr("y", 9)
                        .attr("dy", ".35em")
                        .style("text-anchor", "start")
                        .text(d => d.key);
                });
            }

            cities.forEach(city => visualizeCityData(city));
        })();
    </script>


</body>

</html>